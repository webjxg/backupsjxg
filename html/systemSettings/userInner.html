<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>用户内容</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <!--插件样式-->
    <link rel="stylesheet" href="../../plugins/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="../../plugins/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="../../plugins/ztree/css/metroStyle/metroStyle.css">
    <link rel="stylesheet" href="../../plugins/datatables/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="../../plugins/icheck/skins/square/aero.css">
    <link rel="stylesheet" href="../../plugins/icheck/skins/square/green.css">
    <!--引入样式-->
    <link rel="stylesheet" href="../../css/common.css">
    <link rel="stylesheet" href="../../plugins/datatables/css/mydatatable.css">
    <!--<link rel="stylesheet" href="../../css/userinner.css">-->
    <link rel="stylesheet" href="../../css/dictionaries.css">


</head>
<body>
<div class="wrapper wrapper-content ibox-content">
    <!--顶部搜索-->
    <div class="row">
        <div class="col-sm-12">
            <form id="searchForm" class="form-inline" action="#" method="post">
                <input type="hidden" id="treeId"  >
                <div class="form-group">
                    <div class="company col-sm-12">
                        <span>归属公司：</span>
                        <input id="companyId" name="company.id" class=" form-control input-sm " type="hidden" value="">
                        <div class="input-group ">
                            <input id="companyName" name="company.name" readonly="readonly" type="text" value=""
                                   data-msg-required="" class=" form-control input-sm " style="">
                            <span class="input-group-btn">
                                 <button type="button" id="companyButton" class="btn  btn-sm   btn-primary  "><i
                                         class="fa fa-search"></i>
                                 </button>
                            </span>

                        </div>
                        <label id="companyName-error" class="error" for="officeId" style="display:none"></label>
                        <span >归属部门：</span>
                        <input id="officeId" name="office.id" class=" form-control input-sm " type="hidden" value="">
                        <div class="input-group ">
                            <input id="officeName" name="office.name" readonly="readonly" type="text" value=""
                                   data-msg-required="" class=" form-control input-sm " style="">
                            <span class="input-group-btn">
                                 <button type="button" id="officeButton" class="btn  btn-sm   btn-primary  "><i
                                         class="fa fa-search"></i>
                                 </button>
                            </span>
                        </div>
                        <label id="officeName-error" class="error" for="officeId" style="display:none"></label>
                    </div>
                    <div class="user col-sm-12">
                        <span>姓&nbsp;&nbsp&nbsp;&nbsp; 名：</span>
                        <input id="name" name="name" class=" form-control input-sm" type="text" value="" maxlength="50">
                        <span >登录名：</span>
                        <input id="loginName" name="loginName" class=" form-control input-sm" type="text" value=""
                               maxlength="50">
                    </div>
                </div>
            </form>
            <br>
        </div>
    </div>
    <!--按钮条-->
    <div class="row">
        <div class="col-sm-12">
            <div class="pull-left">
                <button class="btn btn-white btn-sm" data-toggle="tooltip" data-placement="left"
                        onclick="openEditDialog('新增用户','systemSettings/userCheckView.html','800px','600px')" title="添加"><i class="fa fa-plus"></i> 添加
                </button>

                <button class="btn btn-white btn-sm" data-toggle="tooltip" data-placement="left"
                        onclick="edit('修改用户信息','systemSettings/userCheckView.html','800px','500px','#treeTable')" title="修改"><i
                        class="fa fa-file-text-o"></i> 修改
                </button>
                <button class="btn btn-white btn-sm" onclick="deleteAll('确认要删除该用户吗？','/api/sys/SysUser/delete/','#treeTable')"  data-toggle="tooltip" data-placement="top"><i
                        class="fa fa-trash-o"> 删除</i></button>
                <!--<button id="btnImport" class="btn btn-white btn-sm " data-toggle="tooltip" data-placement="left"-->
                        <!--title="导入"><i class="fa fa-folder-open-o"></i> 导入-->
                <!--</button>-->
                <!--<div id="importBox" class="hide">-->
                    <!--<form id="importForm" action="/jeeplus/a/sys/user/import" method="post"-->
                          <!--enctype="multipart/form-data" style="padding-left:20px;text-align:center;"-->
                          <!--onsubmit="loading('正在导入，请稍等...');"><br>-->
                        <!--<input id="uploadFile" name="file" type="file" style="width:330px">导入文件不能超过5M，仅允许导入“xls”或“xlsx”格式文件！<br>　-->
                    <!--</form>-->
                <!--</div>-->
                <!--<button id="btnExport" class="btn btn-white btn-sm " data-toggle="tooltip" data-placement="left"-->
                        <!--title="导出"><i class="fa fa-file-excel-o"></i> 导出-->
                <!--</button>-->
                <button class="btn btn-white btn-sm " id="refresh-btn" data-toggle="tooltip" data-placement="left"
                        onclick="window.location.reload()" title="刷新"><i class="glyphicon glyphicon-repeat"></i> 刷新
                </button>
            </div>
            <div class="pull-right">
                <button class="btn btn-primary btn-rounded btn-outline btn-sm " id="search-btn"><i
                        class="fa fa-search"></i> 查询
                </button>
                <button class="btn btn-primary btn-rounded btn-outline btn-sm " id="reset-btn"><i
                        class="fa fa-refresh"></i> 重置
                </button>
            </div>
        </div>
    </div>
    <!--内容表格-->
    <table id="treeTable"
           class="table table-striped table-bordered table-hover table-condensed dataTables-example dataTable">
        <thead>
        <tr>
            <th><input type="checkbox" class="i-checks" style="position: absolute; opacity: 0;"></th>
            <th>登录名</th>
            <th>姓名</th>
            <th>电话</th>
            <th>手机</th>
            <!--<th>归属公司</th>-->
            <!--<th>归属部门 </th>-->
            <th>操作</th>
        </tr>
        </thead >
        <tbody class="alignCenter">

        </tbody>
    </table>
    <div class="clearfix pagination-box">
        <div class="pagination-detail pull-left">
            <div class="page-info pull-left"></div>
            <div class="page-list pull-left">
                <span>每页显示</span>
                <select name="" id="pag-sel">
                    <option value="5">5</option>
                    <option value="10" selected>10</option>
                    <option value="20">20</option>
                    <option value="25">25</option>
                    <option value="30">30</option>
                    <option value="40">40</option>
                    <option value="50">50</option>
                </select>
                条记录
            </div>
        </div>
        <div id="pagination" class="pagination-roll pull-right"></div>
    </div>
</div>
<!--核心插件-->
<script src="../../js/jquery-2.2.4.min.js"></script>
<script src="../../plugins/bootstrap/js/bootstrap.min.js"></script>
<!--附属插件-->
<script src="../../plugins/ibox.2.2/ibox.js"></script>
<script src="../../plugins/layer/layer.js"></script>
<script src="../../plugins/icheck/icheck.min.js"></script>
<script src="../../plugins/metismenu-master/metisMenu.min.js"></script>
<script src="../../plugins/slimScroll/jquery.slimscroll.min.js"></script>
<script src="../../plugins/ztree/js/jquery.ztree.core.js"></script>
<script src="../../plugins/datatables/js/jquery.dataTables.min.js"></script>
<script src="../../plugins/treetable/jquery.treetable.js"></script>
<script src="../../plugins/bootStrapPager/js/extendPagination.js"></script>
<!--页面依赖js-->
<script src="../../js/public.js"></script>
<script src="../../js/jeeplus.js"></script>
<script src="../../js/customForm.js"></script>
<script src="../../js/page.js"></script>


</body>
<script>
    function updatason(node){
        var data={"deptId":node};
        Page.init("/api/sys/SysUser/page", data, true, function (tableData) {
            console.log(tableData);
            dataout(tableData);
            clickButton()
        });
}
    function clickButton() {
        $('.btn-check').click(function () {
            var id = $(this).parents("tr").find('.i-checks').attr('id');
            openDialog('查看用户信息', './systemSettings/userCheckViewDis.html?id=' + id, '800px', '500px')
        });
        $('.btn-change').click(function () {
            var id = $(this).parents("tr").find('.i-checks').attr('id');
            openEditDialog('修改用户信息', './systemSettings/userCheckView.html?id=' + id, '800px', '500px')
        });
        $('.btn-delete').click(function () {
            var id = $(this).parents("tr").find('.i-checks').attr('id');
            deleteItem('确定要删除该用户吗', '/api/sys/SysUser/delete/',id)
        });
        $('#reset-btn').click(function(){
            // $("#authEnable option:first").prop("selected", 'selected');
            $("#name").val(""),
                // $("#authCodeParam").val(""),
                // $("#desParam").val(),
                Page.reset(["nameParam"]);
        });
    }

    layerInZtree('.input-group:nth-of-type(1)', ['300px', '424px'], './systemSettings/userCompany.html', '1', '#companyName', '#companyId', '请选择归属公司');
    layerInZtree('.input-group:nth-of-type(2)', ['300px', '424px'], './systemSettings/userDepartment.html', '2', '#officeName', '#officeId', '请选择部门');
    window.pageLoad = function () {
        var data = {
            companyId: $("#companyId").val(),
            loginNameParam: $('#loginName').val(),
            deptId: $('#officeId').val(),
            nameParam: $('#name').val(),
            treeId: $('#treeId').val()
        };
        Page.init("/api/sys/SysUser/page", data, true, function (tableData) {
            dataout(tableData);
            clickButton()
        });
    };

    var treeId = getQueryString("treeId");
    $('#treeId').val(treeId);


    pageLoad();
    windowclick();
    //点击重置按钮
    $("#reset-btn").click(function () {
        $("#companyName").val("");
        $('#loginName').val("");
        $('#officeName').val("");
        $('#name').val("");
        Page.reload('companyId','');
    });


    //   ajax请求渲染datatable数据
    function dataout(data) {
        $('#treeTable').dataTable({
            "bPaginate": false,
            "bDestroy": true,
            "paging": false,
            "bProcessing": true,
            "searching": false, //禁用aa原生搜索
            "info": false,  //底部文字
            "order": [],
            "pagingType": "full_numbers",
            "aoColumnDefs": [
                {"bSortable": false, "aTargets": [0, 5]}
            ],
            "oLanguage": lang,
            "data": data,
            //定义列 宽度 以及在json中的列名
            "columns": [
                {
                    "data": null, "width": "8%", "defaultContent": "",
                    "render": function (data, type, row, meta) {
                        return data = "<input type='checkbox' id=" + row.id + " class='i-checks'>"
                    }
                },
                {"data": "loginName", "width": "auto"},
                {"data": "name", "width": "auto"},
                {"data": "phone", "width": "auto"},
                {"data": "mobile", "width": "auto"},
                {"data": "id", "width": "auto","orderable": false, "defaultContent": "",
                    "render": function (data, type, row, meta) {
                        return data = "<a class='btn btn-info btn-xs  btn-check'><i class='fa fa-search-plus'></i>查看</a >" +
                            "<a class='btn btn-success btn-xs btn-change'><i class='fa fa-search-plus'></i>修改</a >" +
                            "<a class='btn btn-danger btn-xs btn-delete'><i class='fa fa-search-plus' ></i>删除</a >"
                    }
                }],

        });
        RenderiCheckTblBody();
    }


</script>

</html>