<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>计划模版</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <!--插件样式-->
    <link rel="stylesheet" href="../../plugins/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="../../plugins/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="../../plugins/easyui/themes/default/easyui.css">
    <link rel="stylesheet" href="../../plugins/easyui/themes/default/datagrid.css">
    <!--引入样式-->
    <link rel="stylesheet" href="../../css/common.css">
    <link rel="stylesheet" href="../../css/aps.css">
<body>
<div class="wrapper">
    <div class="ibox">
        <div class="ibox-content">
            <button class="btn-save btn">保存</button>
            <div class="commercePurCon proTargetPlanItem">
                <div class="tableItemBox">
                    <table id="td0" class="tableItem" title="aa">
                    </table>
                </div>
                <div class="tableItemBox">
                    <table id="td1" class="tableItem"  title="合并单元格">
                    </table>
                </div>
                <div class="tableItemBox">
                    <table id="td2" class="tableItem"  title="合并单元格">
                    </table>
                </div>
                <div class="tableItemBox">
                    <table id="td3" class="tableItem"  title="合并单元格">
                    </table>
                </div>
                <div class="tableItemBox">
                    <table id="td4" class="tableItem"  title="合并单元格">
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!--核心插件-->
<script src="../../js/jquery-2.2.4.min.js"></script>
<script src="../../plugins/bootstrap/js/bootstrap.min.js"></script>
<!--附属插件-->
<script src="../../plugins/layer/layer.js"></script>
<script src="../../plugins/easyui/js/jquery.easyui.min.js"></script>
<script src="../../js/dataGridCustom.js"></script>
<script src="../../js/customForm-aps.js"></script>
<script>
    var cljhArr=[],swcgzbjhArr1=[];
    var loadedData = [];
    var year = getQueryString('year'),
        month = getQueryString('month'),
        week = getQueryString('week');
    console.log(year+":"+month+":"+week);
    var data ={
        dpYear:year,
        dpMonth:month,
        dpWeek:week
    }
    ajaxToServer("/api/aps/DayPlan/form",JSON.stringify(data),function(result){
        var cljh = result.cljh, cljhTit = cljh[0].groupName;
        console.log(cljhTit);
        for ( var item in cljh) {
            var arrItem = {
                'id':cljh[item].id,
                'itemName': cljh[item].itemName,
                'itemUnit': cljh[item].itemUnit,
                'groupName': cljh[item].groupName,
                'mouthPlan': cljh[item].mouthPlan,
                'weekPlan': cljh[item].weekPlan,
                'remark': cljh[item].remark
            };
            cljhArr.push(arrItem);
        }

        $('#td0').datagrid('loadData',cljh);
    });
    $('#td0').datagrid({
        fitColumns:true,
        collapsible:true,
        singleSelect: true,
        onClickRow: function(index){
            dataGridObj.startEditing(index,"#td0")
        },
        columns:[[
            {field:'id',title:'id', hideColumn:'id'},
            {field:'groupName',title:'',width:100,align:'center'},
            {field:'itemName',title:'项目',width:100,align:'center'},
            {field:'itemUnit',title:'单位',width:100,align:'center'},
            {field:'mouthPlan',title:'月计划',width:100,align:'center'},
            {field:'weekPlan',title:'日计划',width:100,align:'center'},
            {field:'remark',title:'备注',editor:'text',width:150,align:'center'},
        ]],
        onAfterEdit: function (rowIndex, rowData, changes) {
            dataGridObj.pushRowData(rowData);
            dataGridObj.setEditIndex("#td0",undefined);
            dataGridObj.mergeCells(loadedData,"#td0","groupName");
        },
        onLoadSuccess: function(data){                      //data是默认的表格加载数据，包括rows和Total
            loadedData = data;
            dataGridObj.mergeCells(data,"#td0","groupName");
        },
        toolbar: [{
            text: '保存22', iconCls: 'icon-save', handler: function () {
                //保存时结束当前编辑的行，自动触发onAfterEdit事件如果要与后台交互可将数据通过Ajax提交后台
                $('#td0').datagrid('endEdit', dataGridObj.getEditIndex("#td0"));
            }
        }]
    });
   $(function(){
       $("#td0").attr("title",cljhTit);
       $('#td0,#td1,#td2,#td3,#td4').datagrid('hideColumn', 'id');
   })

</script>
</body>
</html>