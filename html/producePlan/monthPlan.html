<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>月计划</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link rel="stylesheet" href="../../plugins/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="../../plugins/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="../../plugins/easyui/themes/default/easyui.css">
    <link rel="stylesheet" href="../../plugins/easyui/themes/default/datagrid.css">
    <!--引入样式-->
    <link rel="stylesheet" href="../../css/common.css">
    <link rel="stylesheet" href="../../css/customDatagrid.css">
    <link rel="stylesheet" href="../../css/aps.css">
</head>
<body>
<div class="wrapper">
    <div class="ibox">
        <div class="ibox-content">
            <div class="commercePurCon proTargetPlanItem">
                <div class="tableItemBox">
                    <table id="td0" class="tableItem"  title="合并单元格">
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>


<!--核心插件-->
<script src="../../js/jquery-2.2.4.min.js"></script>
<script src="../../plugins/bootstrap/js/bootstrap.min.js"></script>
<!--附属插件-->
<script src="../../plugins/layer/layer.js"></script>
<script src="../../plugins/easyui/js/jquery.easyui.min.js"></script>

<script src="../../js/dataGridCustom.js"></script>

<script>

    var swcgzbjhArr=[],swcgzbjhArr1=[];
    $.ajax({
        dataType : "json",
        url:"../../json/test-dic.json",
        success:function(result){
            var data = result.cpcl;
            for ( var item in data) {
                var arrItem = {
                    'id':data[item].id,
                    'itemName': data[item].itemName,
                    'itemUnit': data[item].itemUnit,
                    'groupName': data[item].groupName,
                    'remark': data[item].remark
                };
                swcgzbjhArr.push(arrItem);
            }
            $('#td0').datagrid('loadData',data);

        }

    });
    $('#td0').datagrid({
        fitColumns:true,
        collapsible:true,
        singleSelect: true,
        onClickRow: function(index){
            dataGridObj.startEditing(index,"#td0")
        },
        columns:[[
            {field:'id',title:'id', hideColumn:'id'},
            {field:'groupName',title:' ',width:100,align:'center'},
            {field:'itemName',title:'项目',width:100,align:'center'},
            {field:'itemUnit',title:'单位',width:100,align:'center'},
            {field:'remark',title:'备注',editor:'text',width:150,align:'center'},
        ]],
        onAfterEdit: function (rowIndex, rowData, changes) {
            dataGridObj.pushRowData(rowData);
            dataGridObj.setEditIndex("#td0",undefined);
        },
        onLoadSuccess: function(data){                      //data是默认的表格加载数据，包括rows和Total
            var mark=1;                                                 //这里涉及到简单的运算，mark是计算每次需要合并的格子数
            for (var i=1; i <data.rows.length; i++) {     //这里循环表格当前的数据
                if (data.rows[i]['groupName'] == data.rows[i-1]['groupName']) {   //后一行的值与前一行的值做比较，相同就需要合并
                    mark += 1;
                    $(this).datagrid('mergeCells',{
                        index: i+1-mark,                 //datagrid的index，表示从第几行开始合并；紫色的内容需是最精髓的，就是记住最开始需要合并的位置
                        field: 'groupName',                 //合并单元格的区域，就是clomun中的filed对应的列
                        rowspan:mark                   //纵向合并的格数，如果想要横向合并，就使用colspan：mark
                    });
                }else{
                    mark=1;                                         //一旦前后两行的值不一样了，那么需要合并的格子数mark就需要重新计算
                }
            }
        },
        toolbar: [{
            text: '保存22', iconCls: 'icon-save', handler: function () {
                //保存时结束当前编辑的行，自动触发onAfterEdit事件如果要与后台交互可将数据通过Ajax提交后台
                $('#td0').datagrid('endEdit', dataGridObj.getEditIndex("#td0"));
            }
        }]
    });


    $(function(){
        $('#td0').datagrid('hideColumn','id');

    });



</script>
</body>
</html>