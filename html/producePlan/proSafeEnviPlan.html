<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" content="width=device-width,initial-scale=1.0">
    <title>Title</title>
    <!--插件样式-->
    <link rel="stylesheet" href="../../plugins/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="../../plugins/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="../../plugins/easyui/themes/default/easyui.css">
    <link rel="stylesheet" href="../../plugins/easyui/themes/default/datagrid.css">
    <!--引入样式-->
    <link rel="stylesheet" href="../../css/common.css">
    <link rel="stylesheet" href="../../css/customDatagrid.css">
    <link rel="stylesheet" href="../../css/aps.css">
</head>

<body>
<div  class="wrapper wrapper-content ibox-content">
    <div class="ibox">
        <div class="ibox-content">
            <div class="row">
                <div class="col-lg-12">
                    <div class="pull-left">
                    </div>
                    <div class="pull-right">
                        <button class="btn btn-save">保存</button>
                    </div>
                </div>
            </div>
            <div class="tableItemBox">
                <table id="td0"  class="tableItem"></table>
            </div>
        </div>
    </div>
</div>
<!--表格区-->
</body>
<script src="../../js/jquery-2.2.4.min.js"></script>
<script src="../../plugins/bootstrap/js/bootstrap.min.js"></script>
<!--附属插件-->
<script src="../../plugins/layer/layer.js"></script>
<script src="../../plugins/easyui/js/jquery.easyui.min.js"></script>
<script src="../../js/dataGridCustom.js"></script>
<script src="../../js/customForm-aps.js"></script>
<script>
    var arr = []
    getmsg();
    var planarr = []
    function getmsg(dateyear) {

        var data={
            adYear:2018,
            adMonth:11
        };
        ajaxToServer1("/api/aps/ApsMonthAdjustAqhbjh/queryMonthAdjustAqhbjh",data,function (result) {
            console.log(result);
           planarr = result.aqhbsbglztzbjh
           console.log(planarr)
            createTbody(planarr)
        })
    }
    function createTbody(planarr) {
        console.log(planarr)
        for(var i=0;i<planarr.length;i++){
            console.log(planarr[i]) //每种类型的数据，放在一个数组里边
                msgobj = {
                    "id":planarr[i].id,
                    "itemName":planarr[i].itemName,
                    "itemUnit":planarr[i].itemUnit,
                    "indexValue":planarr[i].indexValue,
                    "remark":planarr[i].remark,
                };
                arr.push(msgobj)
                console.log(arr)
            }
            $('#td0').datagrid('loadData',arr);

    };
    $("#td0").datagrid({
        fitColumns:true,
        collapsible:true,
        singleSelect: true,
        onClickRow: function(index){
            dataGridObj.startEditing(index,"#td0")
        },
        //创建table
        columns:[[
            {field:'id',title:'id',hideColumn:'id'},
            {field:'itemName',title:'指标名称',width:100,align:'center'},
            {field:'itemUnit',title:'单位',width:100,align:'center'},
            {field:'indexValue',title:'指标值',editor:'text',width:100,align:'center'},
            {field:'remark',title:'备注',editor:'text',width:100,align:'center'},
        ]],
        onAfterEdit: function (rowIndex, rowData, changes) {
            dataGridObj.pushRowData(rowData);
            dataGridObj.setEditIndex("#td0",undefined);
            dataGridObj.mergeCells(loadedData,"#td0","groupName");
        },
        //合并单元格
        onLoadSuccess:function (data) {
            loadedData = data;
            dataGridObj.mergeCells(data,"#td0","groupName");
        },
        toolbar: [{
            text: '保存', iconCls: 'icon-save', handler: function () {
                //保存时结束当前编辑的行，自动触发onAfterEdit事件如果要与后台交互可将数据通过Ajax提交后台
                $('#td0').datagrid('endEdit', dataGridObj.getEditIndex("#td0"));
            }
        }]
    })
    //隐藏id列
    $(function(){
        $('#td0').datagrid('hideColumn','id');
    });
    // 点击保存按钮
    $(".btn-save").click(function () {
        console.log(dataGridObj.saveItemArr)
        var data = JSON.stringify(dataGridObj.saveItemArr)
        console.log(data)
        ajaxToServer("/api/aps/ApsMonthAdjustAqhbjh/saveAqhbjhInfo",data,function (result) {
            console.log(result.message)
        })
    })
    
    // $(".btn-save").click(function (e) {
    //     var btn = $(e.target).context.textContent
    //     if(btn == "保存"){
    //         status = "0";
    //         addstatus(status)
    //     }else{
    //         status = "1";
    //         addstatus(status)
    //     }
    // })
    // //将点击状态添加到数组里边
    // function addstatus(status) {
    //     var len = $(".tableItemBox").length;
    //     console.log(len)
    //     for(var i = 0; i<len;i++){
    //         console.log($("#td"+i))
    //         // 给每个虚拟btn添加点击事件
    //         $("#td"+i).parents('.datagrid-view').siblings(".datagrid-toolbar").find(".l-btn-text").trigger('click');
    //     }
    //     console.log(status);
    //     for(var i=0;i<dataGridObj.saveItemArr.length;i++){
    //         dataGridObj.saveItemArr[i].status= status;
    //     };
    //     var data = dataGridObj.saveItemArr;
    //     sendmsg(data)  //将数据发送给后台
    // }
    // function sendmsg(data) {
    //     console.log(data);
    //     var datastring = JSON.stringify(data);
    //     ajaxToServer("/api/aps/ApsYearPlan/saveYearInfo",datastring,function (result) {
    //         layer.msg(result.message)
    //     });
    // }
</script>
</html>