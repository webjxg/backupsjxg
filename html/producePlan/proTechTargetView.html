<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>全厂主要生产技术指标计划</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link rel="stylesheet" href="../../plugins/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="../../plugins/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="../../plugins/easyui/themes/default/easyui.css">
    <link rel="stylesheet" href="../../plugins/easyui/themes/default/datagrid.css">
    <!--引入样式-->
    <link rel="stylesheet" href="../../css/common.css">
    <link rel="stylesheet" href="../../css/customDatagrid.css">
    <link rel="stylesheet" href="../../css/aps.css">
</head>
<body>
<div class="wrapper">
    <div class="ibox">
        <div class="ibox-content">
            <div class="commercePurCon proTargetPlanItem">
                <div class="tableItemBox">
                    <table id="td0" class="tableItem"  title="产量计划">
                    </table>
                </div>
                <div class="tableItemBox">
                    <table id="td1" class="tableItem"  title="各项单耗指标计划">
                    </table>
                </div>
                <div class="tableItemBox">
                    <table id="td2" class="tableItem"  title="技术指标计划">
                    </table>
                </div>
                   <div class="tableItemBox">
                    <table id="td3" class="tableItem"  title="质量指标计划">
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
<!--核心插件-->
<script src="../../js/jquery-2.2.4.min.js"></script>
<script src="../../plugins/bootstrap/js/bootstrap.min.js"></script>
<!--附属插件-->
<script src="../../plugins/layer/layer.js"></script>
<script src="../../plugins/easyui/js/jquery.easyui.min.js"></script>
<script src="../../js/dataGridCustom.js"></script>
<script src="../../js/customForm-aps.js"></script>
<script>
    var year =getQueryString('year'),
        month =getQueryString('month');
        var clzbjhs =[];
        var gxdhzbjhs = [];
        var jszbjhs  =[];
        var zlzbjhs = [];
        $(document).ready(function(){
            var data = {
                adYear:year,
                adMonth:month
            };
            var tit = month<10?month.substr(1,1):month;
              ajaxToServer("/api/aps/ApsMonthAdjustTech/queryMonthAdjustTech",JSON.stringify(data),function(result){
            	var clzbjh = result.clzbjh;
            	var gxdhzbjh  =result.gxdhzbjh;
            	var jszbjh = result.jszbjh;
            	var zlzbjh = result.zlzbjh;
//          	//产量指标计划
            	for(var i=0;i<clzbjh.length;i++){
            		var itemmsg = {
            			"id":clzbjh[i].id,
            			"mainId":clzbjh[i].mainId,
            			"itemName":clzbjh[i].itemName,
            			"itemUnit":clzbjh[i].itemUnit,
            			"yearTarget":clzbjh[i].yearTarget,
            			"monthPlan":clzbjh[i].monthPlan,
            			"remark":clzbjh[i].remark
            		}
            		clzbjhs.push(itemmsg);
            	}
            	//各项单耗指标计划
            	 for(var i=0;i<gxdhzbjh.length;i++){
            		var itemmsg = {
            			"id":gxdhzbjh[i].id,
            			"mainId":gxdhzbjh[i].mainId,
            			"groupName":gxdhzbjh[i].itemName,
            			"itemUnit":gxdhzbjh[i].itemUnit,
            			"yearTarget":gxdhzbjh[i].yearTarget,
            			"monthPlan":gxdhzbjh[i].monthPlan,
            			"remark":gxdhzbjh[i].remark
            		}
            		gxdhzbjhs.push(itemmsg);
            	}
            	 //计划指标计划
            	 for(var i=0;i<jszbjh.length;i++){
            	 		var itemmsg = {
            			"id":jszbjh[i].id,
            			"mainId":jszbjh[i].mainId,
            			"groupName":jszbjh[i].itemName,
            			"itemUnit":jszbjh[i].itemUnit,
            			"yearTarget":jszbjh[i].yearTarget,
            			"monthPlan":jszbjh[i].monthPlan,
            			"remark":jszbjh[i].remark
            		}
            		jszbjhs.push(itemmsg);
            	 }
            	 //质量指标计划
            	 for(var i=0;i<zlzbjh.length;i++){
            	 		var itemmsg = {
            			"id":zlzbjh[i].id,
            			"mainId":zlzbjh[i].mainId,
            			"groupName":zlzbjh[i].itemName,
            			"itemUnit":zlzbjh[i].itemUnit,
            			"yearTarget":zlzbjh[i].yearTarget,
            			"monthPlan":zlzbjh[i].monthPlan,
            			"remark":zlzbjh[i].remark
            		}
            		zlzbjhs.push(itemmsg);
            	 }
            	 $('#td0').datagrid('loadData',clzbjh);
            	  $('#td1').datagrid('loadData',gxdhzbjhs);
            	   $('#td2').datagrid('loadData',jszbjhs);
            	   $('#td3').datagrid('loadData',zlzbjhs);
                  setFrameHeight();
         })
})
                
//    //产量计划
      $("#td0").datagrid({
          fitColumns:true,
          collapsible:true,
          singleSelect: true,
          onClickRow: function(index){
              //dataGridObj.startEditing(index,"#td0")
          },
          columns:[[
              {field:'id',title:'id',hideColumn:'id'},
               {field:'mainId',title:'mainId',hideColumn:'mainId'},
              {field:'itemName',title:'项目',width:100,align:'center'},
                {field:'itemUnit',title:'单位',width:100,align:'center'},
                {field:'yearTarget',title:'全年基本目标',editor:'text',width:100,align:'center'},
                {field:'monthPlan',title:month+'月计划',editor:'text',width:100,align:'center'},
                {field:'remark',title:'备注',editor:'text',width:100,align:'center'}
            ]],
            onAfterEdit: function (rowIndex, rowData, changes) {
                dataGridObj.pushRowData(rowData);
                dataGridObj.setEditIndex("#td0",undefined);
                dataGridObj.mergeCells(loadedData,"#td0","itemName");
            },
            //合并单元格
            onLoadSuccess:function (data) {
                loadedData = data;
                dataGridObj.mergeCells(data,"#td0","itemName");
            },
            toolbar: [{
                text: '保存', iconCls: 'icon-save', handler: function () {
                    //保存时结束当前编辑的行，自动触发onAfterEdit事件如果要与后台交互可将数据通过Ajax提交后台
                    $('#td0').datagrid('endEdit',dataGridObj.getEditIndex("#td0"));
                }
            }]
        })
      
//   各项单耗指标计划
           $("#td1").datagrid({
          fitColumns:true,
          collapsible:true,
          singleSelect: true,
          onClickRow: function(index){
              //dataGridObj.startEditing(index,"#td1")
          },
          //创建table
          columns:[[
              {field:'id',title:'id',hideColumn:'id'},
              {field:'mainId',title:'mainId',hideColumn:'mainId'},
              {field:'groupName',title:'项目',width:100,align:'center'},
                {field:'itemUnit',title:'单位',width:100,align:'center'},
                {field:'yearTarget',title:'全年基本目标',editor:'text',width:100,align:'center'},
                {field:'monthPlan',title:month+'月计划',editor:'text',width:100,align:'center'},
                {field:'remark',title:'备注',editor:'text',width:100,align:'center'}
            ]],
            onAfterEdit: function (rowIndex, rowData, changes) {
                dataGridObj.pushRowData(rowData);
                dataGridObj.setEditIndex("#td1",undefined);
                dataGridObj.mergeCells(loadedData,"#td1","groupName");
            },
            //合并单元格
            onLoadSuccess:function (data) {
                loadedData = data;
                dataGridObj.mergeCells(data,"#td1","groupName");
            },
            toolbar: [{
                text: '保存', iconCls: 'icon-save', handler: function () {
                    //保存时结束当前编辑的行，自动触发onAfterEdit事件如果要与后台交互可将数据通过Ajax提交后台
                    $('#td1').datagrid('endEdit',dataGridObj.getEditIndex("#td1"));
                }
            }]
        })
//    技术指标计划
		  $("#td2").datagrid({
          fitColumns:true,
          collapsible:true,
          singleSelect: true,
          onClickRow: function(index){
             // dataGridObj.startEditing(index,"#td2")
          },
          //创建table
          columns:[[
              {field:'id',title:'id',hideColumn:'id'},
              {field:'mainId',title:'mainId',hideColumn:'mainId'},
              {field:'groupName',title:'项目',width:100,align:'center'},
                {field:'itemUnit',title:'单位',width:100,align:'center'},
                {field:'yearTarget',title:'全年基本目标',editor:'text',width:100,align:'center'},
                {field:'monthPlan',title:month+'月计划',editor:'text',width:100,align:'center'},
                {field:'remark',title:'备注',editor:'text',width:100,align:'center'}
            ]],
            onAfterEdit: function (rowIndex, rowData, changes) {
                dataGridObj.pushRowData(rowData);
                dataGridObj.setEditIndex("#td2",undefined);
                dataGridObj.mergeCells(loadedData,"#td2","groupName");
            },
            //合并单元格
            onLoadSuccess:function (data) {
                loadedData = data;
                dataGridObj.mergeCells(data,"#td2","groupName");
            },
            toolbar: [{
                text: '保存', iconCls: 'icon-save', handler: function () {
                    //保存时结束当前编辑的行，自动触发onAfterEdit事件如果要与后台交互可将数据通过Ajax提交后台
                    $('#td2').datagrid('endEdit',dataGridObj.getEditIndex("#td2"));
                }
            }]
        })
//   产量指标计划
		$("#td3").datagrid({
          fitColumns:true,
          collapsible:true,
          singleSelect: true,
          onClickRow: function(index){
             // dataGridObj.startEditing(index,"#td3")
          },
          //创建table
          columns:[[
              {field:'id',title:'id',hideColumn:'id'},
              {field:'mainId',title:'mainId',hideColumn:'mainId'},
              {field:'groupName',title:'项目',width:100,align:'center'},
                {field:'itemUnit',title:'单位',width:100,align:'center'},
                {field:'yearTarget',title:'全年基本目标',editor:'text',width:100,align:'center'},
                {field:'monthPlan',title:month+'月计划',editor:'text',width:100,align:'center'},
                {field:'remark',title:'备注',editor:'text',width:100,align:'center'}
            ]],
            onAfterEdit: function (rowIndex, rowData, changes) {
                dataGridObj.pushRowData(rowData);
                dataGridObj.setEditIndex("#td3",undefined);
                dataGridObj.mergeCells(loadedData,"#td3","groupName");
            },
            //合并单元格
            onLoadSuccess:function (data) {
                loadedData = data;
                dataGridObj.mergeCells(data,"#td3","groupName");
            },
            toolbar: [{
                text: '保存', iconCls: 'icon-save', handler: function () {
                    //保存时结束当前编辑的行，自动触发onAfterEdit事件如果要与后台交互可将数据通过Ajax提交后台
                    $('#td3').datagrid('endEdit',dataGridObj.getEditIndex("#td3"));
                }
            }]
        })


    $(function(){
        $('#td0,#td1,#td2,#td3').datagrid('hideColumn','id');
	 });
	     $(function(){
        $('#td0,#td1,#td2,#td3').datagrid('hideColumn','mainId');
	 });
//
        //点击时获取到信息
        $(".btn-save").click(function (e) {
            var btn = $(e.target).context.textContent;
            if(btn == "保存"){
                status = "0";
                addstatus(status)
            }else{
                status = "1";
                addstatus(status)
            }
        })
        //将点击状态添加到数组里边
        function addstatus(status) {
            var len = $(".tableItemBox").length;
            for(var i = 0; i<len;i++){
                // 给每个虚拟btn添加点击事件
                $("#td"+i).parents('.datagrid-view').siblings(".datagrid-toolbar").find(".l-btn-text").trigger('click');
            }
            var savearr = [];
            var editItems = dataGridObj.saveItemArr;

            $(editItems).each(function (i) {
                savearr.push(editItems[i]);
            });
            var data={
                "techPlans":JSON.stringify(editItems),
                "status":status,
            };
            addmsg(data)  //将数据发送给后台
        }
//
//        保存将数据发送给后台
    function addmsg(data){
        ajaxToServer1("/api/aps/ApsMonthAdjustTech/saveTechInfo",data,function(result){
        })
    }




</script>

</body>
</html>