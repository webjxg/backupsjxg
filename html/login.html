<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>登录页面</title>
    <link rel="stylesheet" href="../plugins/bootstrap/css/bootstrap.min.css">
    <style>
        .login-box{margin:10px auto;width:500px;}
        .block{
            display: block;
        }
        span.error{
            color:red;
        }
        input.error{border:1px solid red;}
        input:focus{outline: none;}
    </style>
</head>
<body>
    <div class="login-box ">
        <form action="" method="post" novalidate="novalidate" id="loginSubmit">
            <input  type="text" name="clientId" value="admin">
            <label class="block">
                <input id="loginName" type="text" name="loginName" placeholder="请输入用户名" required minlength="2" >
            </label>
            <label class="block">
                <input id="password" type="password" name="password" placeholder="请输入密码" required >
            </label>
            <div>
                <label><input type="checkbox" id="rememberMe">记住密码</label>
            </div>
            <div>
                <button type="button" class="login-btn" >登录</button>
            </div>
        </form>
        <hr>
        <input type="text" id="url"  value="/api/sys/SysDict/form/5888f7ed81f9486e91b0daeb061deabe">
        <button class="test-btn">测试</button>
    </div>
    <script src="../js/jquery-2.2.4.min.js"></script>
    <script src="../plugins/validate/jquery.validate.min.js"></script>
    <script src="../plugins/layer/layer.js"></script>
    <script src="../plugins/validate/messages_zh.min.js"></script>
    <script src="../js/common.js"></script>
    <script src="../js/customForm.js"></script>
    <script>
        $(function(){
            $(".login-btn").click(function(){
                $("#loginSubmit").submit();
            });
            $("#rememberMe").change(function(){
                setCookie("rememberMe",this.checked?"true":"false");
            });
           var rememberMe = getCookie("rememberMe");
           if(rememberMe == "true"){
                var tokenType = getCookie("token_type"),
                    authorization = getCookie("authorization");
                if(tokenType && tokenType != "" && authorization && authorization != ""){
                    location.href="index.html";
                }else{
                    $("#loginName").val(getCookie("loginName"));
                    $("#rememberMe").prop("checked",true);
                }
           }


        });
        $("#loginSubmit").validate({
            submitHandler:function(){
               var data = JSON.stringify($("#loginSubmit").serializeJSON());
               console.log(data);
                ajaxToServer("/oauth/token",data,function(result){
                    if(result.success){
                        alert("chen");
                        setCookie("authorization",result.accessToken.authorization);
                        setCookie("token_type",result.accessToken.token_type);
                        setCookie("userName",result.user.name);
                        setCookie("loginName",result.user.loginName);

                        location.href="index.html";
                    }else{
                        alert(result.message);
                    }
                })


            },
            errorContainer: "#messageBox",
            errorElement:"span",
            errorPlacement: function(error, element) {
                $("#messageBox").text("输入有误，请先更正。");
                if (element.is(":checkbox")||element.is(":radio")||element.parent().is(".input-append")){
                    error.appendTo(element.parent().parent());
                } else {
                    error.insertAfter(element);
                }
            }
        });

        $(".test-btn").click(function(){
            var url = $("#url").val();
            ajaxToServer(url,{},function(result){
                console.log(result)
            });
        });

    </script>
</body>
</html>