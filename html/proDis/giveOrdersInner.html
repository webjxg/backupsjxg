<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>指标</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link rel="stylesheet" href="../../plugins/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="../../plugins/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="../../plugins/icheck/skins/square/green.css">
    <link rel="stylesheet" href="../../plugins/icheck/skins/square/aero.css">
    <!--引入样式-->
    <!--<link rel="stylesheet" href="../../css/common.css">-->
    <link rel="stylesheet" href="../../css/customDataTable.css">
    <link rel="stylesheet" href="../../css/aps.css">
    <link rel="stylesheet" href="../../css/common.css">


    <style>
        body>.wrapper{
            overflow-x: hidden;
        }
        .btn-giveOrder{
            margin-top: 30px;
        }
        .wrapper {
            min-height: auto;
        }

    </style>
</head>
<body>

<div class="wrapper wrapper-content ibox-content">
    <!--内容表格-->
    <table id="treeTable" class="table table-striped table-bordered table-hover table-condensed dataTables-example dataTable">
        <thead>
        <tr class="alignCenter">
            <th style="width: 10%;border: none;"></th>
            <th>指令</th>
        </tr>
        </thead>
        <tbody id="treeTableBody" >

        </tbody>
    </table>

</div>




<!--核心插件-->
<script src="../../js/jquery-2.2.4.min.js"></script>
<script src="../../plugins/bootstrap/js/bootstrap.min.js"></script>
<!--附属插件-->
<script src="../../plugins/layer/layer.js"></script>
<script src="../../plugins/icheck/icheck.min.js"></script>
<script src="../../plugins/treetable/jquery.treetable.js"></script>
<!--公共样式-->
<script src="../../js/public.js"></script>
<script src="../../js/customForm-aps.js"></script>

<script>
    $(document).ready(function(){
        var data={};
        parent.ajaxTo('/api/ctrl/DirectiveIssued/list',JSON.stringify(data),function (data) {
            issuedUser=data.rows[0].issuedUser;
            groupsId=data.rows[0].id;
            shiftId=data.rows[0].shift.id;
        });

    });
    function updatason(node){
        var data={
            "id":node
        };
        var da=JSON.stringify(data);
        ajaxToServer("/api/ctrl/BaseDirective/rightList/",da,function(tableData){
            renderTableData(tableData);
        })
    }
    function giveorder() {
            var str="";
            var ids="";
            $(".wrapper input.i-checks:checkbox").each(function(){
                if(true == $(this).is(':checked')){
                    str+=","+$(this).attr("id");
                }
            });
            if(str.length>0){
                ids=str.substr(1);
                var data={
                    ids:ids,
                    issuedUser:issuedUser,
                    groupsId:groupsId,
                    shiftId:shiftId
                };
                ajaxToServer("/api/ctrl/DirectiveIssued/save/",JSON.stringify(data),function(result){
                    if(result.success){
                        top.layer.alert('请求成功',function () {
                            top.layer.closeAll();
                            window.location.reload();
                            parent.location.reload();

                        });

                    }else{
                        layer.msg(result.message);
                    }

                });

            }else{
                top.layer.alert('请至少选择一条数据递交!', {icon: 0, title:'警告'});
            }
    }

    //渲染表
    function renderTableData(data) {
        //↓接口到后修改↓
        var tablehead=
                "<tr>" +
                    "<td>" +
                        "<input type='checkbox' id='" + data.pList[0].id+ "' class='i-checks'>"+
                    "</td>" +
                    "<td>"+data.pList[0].content+"</td>"+
                "</tr>";
        var datas=data.childList;
        var tableStr = "";
        for (var i =0; i < datas.length; i++) {
            tableStr += "<tr class='alignCenter' >"
                            + "<td>" +
                                "<input type='checkbox' id='" + datas[i].id+ "' class='i-checks'>"+
                              "</td>" +
                              "<td>"+datas[i].content+"</td>"
                      + "</tr>";
        }
        $('#treeTableBody').html(tablehead+tableStr);
        icheckinner()
    }



</script>
</body>
</html>