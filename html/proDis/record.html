<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>交接班记录</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
</head>
<!--插件样式-->
<link rel="stylesheet" href="../../plugins/bootstrap/css/bootstrap.min.css">
<link rel="stylesheet" href="../../plugins/font-awesome/css/font-awesome.min.css">
<link rel="stylesheet" href="../../plugins/datetimepicker/css/bootstrap-datetimepicker.css">
<link rel="stylesheet" href="../../plugins/datatables/css/jquery.dataTables.min.css">
<link rel="stylesheet" href="../../plugins/icheck/skins/square/green.css">
<link rel="stylesheet" href="../../plugins/datatables/css/mydatatable.css">
<!--引入样式-->
<link rel="stylesheet" href="../../css/common.css">
<link rel="stylesheet" href="../../css/customDataTable.css">
<link rel="stylesheet" href="../../css/aps.css">
<link rel="stylesheet" href="../../css/proDis.css">
<body id="menu-content">
    <div class="wrapper wrapper-content">
        <div class="ibox">
            <div class="ibox-title">
                <h1 class="titName">交接班记录</h1>
                <hr/>
            </div>
            <div class="ibox-content">
                <div class="row">
                    <div class="col-sm-12">
                        <div class="pull-left">
                            <label>
                                <div class="execution time">
                                    <span>执行时间:</span>
                                    <input type="text" value="开始时间" id="startDateParam" class="time-input datePicker"><i class="fa fa-calendar"></i>
                                    &nbsp;&nbsp;—
                                    <input type="text" value="结束时间" id="endDateParam" class="time-input datePicker"><i class="fa fa-calendar"></i>
                                </div>
                            </label>
                            <ul class="apsType-linkage">
                                <li class="year">
                                    工序:
                                    <select name="" id="process">
                                        <option>-- 全部 --</option>
                                    </select>
                                </li>
                                <li>
                                    班次:
                                    <select name="" id="time">
                                        <option>-- 全部 --</option>
                                    </select>
                                </li>
                                <li >
                                    班组:
                                    <select name="" id="team">
                                        <option>-- 全部 --</option>
                                    </select>
                                </li>
                            </ul>
                        </div>
                        <div class="pull-right">
                            <label>
                                <button class="btn btn-search  bg-ffa82d" type="button">查询</button>
                            </label>
                    </div>

                    </div>
                </div>

                <div id="treeTable_wrapper" class="dataTable_wrapper form-inline dt-bootstrap no-footer">
                    <div class="row">
                        <div class="col-sm-12">
                            <!--表格区-->
                            <table id="treeTable" class="table table-striped table-bordered table-hover table-condensed dataTables-example dataTable tree_table">
                                <thead>
                                <tr>
                                    <th>工序</th>
                                    <th>班次</th>
                                    <th>班组</th>
                                    <th>交班人</th>
                                    <th>接班人</th>
                                    <th>交班日期</th>
                                    <th>接班日期</th>
                                </tr>
                                </thead>
                                <tbody id="treeTableBody">
                                </tbody>
                            </table>
                        </div>
                    </div>

                </div>
                <!--分页显示-->
                <div class="clearfix pagination-box">
                    <div class="pagination-detail pull-left" style="display: block;">
                        <div class="page-info pull-left">显示第1到第6条记录，总共 6条记录</div>
                        <div class="page-list pull-left">
                            <span>每页显示</span>
                            <select name="" id="pag-sel">
                                <option value="">请选择</option>
                                <option value="5">5</option>
                                <option value="10" selected="">10</option>
                                <option value="20">20</option>
                                <option value="25">25</option>
                                <option value="30">30</option>
                                <option value="40">40</option>
                                <option value="50">50</option>
                                <option value="-1">all</option>
                            </select>
                            条记录
                        </div>
                    </div>
                    <div id="pagination" class="pagination-roll pull-right"> <ul class="pagination"> <li class="previous"><a href="#">«</a></li><li class="disabled hidden"><a href="#">...</a></li> <li class="active"><a href="#">1</a></li><li class="disabled hidden"><a href="#">...</a></li><li class="next"><a href="#">»</a></li></ul></div>
                </div>
            </div>
        </div>
    </div>
</body>
<!--核心插件-->
<script src="../../js/jquery-2.2.4.min.js"></script>
<script src="../../plugins/bootstrap/js/bootstrap.min.js"></script>
<!--附属插件-->
<script src="../../plugins/layer/layer.js"></script>
<script src="../../plugins/icheck/icheck.min.js"></script>
<script src="../../plugins/ztree/js/jquery.ztree.core.js"></script>
<script src="../../plugins/datatables/js/jquery.dataTables.min.js"></script>
<script src="../../plugins/datatables/js/dataTables.bootstrap.js"></script>
<script src="../../plugins/bootStrapPager/js/extendPagination.js"></script>
<script src="../../plugins/datetimepicker/js/bootstrap-datetimepicker.js"></script>

<!--自定义文件-->
<script src="../../js/common.js"></script>
<script src="../../js/customForm.js"></script>
<script src="../../js/page.js"></script>
<script>

//        $(function () {
//            window.pageLoad = function () {
//                var data = {
//                    begin:$("#startDateParam").val(),
//                    endtime:$("#endDateParam").val(),
//                    process:$("#process option:selected").val(),
//                    team:$("#team option:selected").val(),
//                    time:$("#time option:selected").val(),
//                    status:$(".status input:checkbox:checked").next().text(),
//                    rank:$("#rank option:selected").val(),
//                    classify:$("#classify option:selected").val()
//                };
//                page.init("/api/sys/SysRole/page",data,true,function (result) {
//                    createTable(result);
//                    $(".btn-search").click(function () {
//                        loadData();
//                    })
//                })
//            }
//        });


    //页面加载
    $(window).load(function() {
                //获取班次数据
                loadShift();
                //获取班组数据
                loadGroups();
                //获取工序数据
                loadProcess();
                //调用接口加载数据
                loadData();
        });

        //获取年月日日期
        $("#startDateParam").datetimepicker({
            format: "yyyy-mm-dd",
            language:'cn',
            weekStart: 1,
            pickTime: false,
            autoclose:true,
            minView: "4",
            forceParse: 0,
            todayBtn: true
        }).on('change',function(ev){
            var startDate = $('#startDateParam').val();
            $("#endDateParam").datetimepicker('setStartDate',startDate);
            $("#startDateParam").datetimepicker('hide');
        });
        $("#endDateParam").datetimepicker({
            format: "yyyy-mm-dd",
            language:'cn',
            weekStart: 1,
            pickTime: false,
            autoclose:true,
            minView: "4",
            forceParse: 0,
            todayBtn: true
        }).on('change',function(ev){
            var returnDate = $("#endDateParam").val();
            $("#startDateParam").datetimepicker('setReturnDate',returnDate);
            $("#endDateParam").datetimepicker('hide');
        });


        //获取工序数据
        function loadProcess(){
            var url_ = 'http://localhost:63342/branch/json/proDis/gongxu.json';
            ajaxToServer(url_, {}, function(result){
                if(result.success){
                    var rows = result.rows;
                    appendOptionsValue($('#process'), rows, 'code', 'name');
                }else{
                    layer.msg(result.message);
                }
            });
        }
        //获取班次数据
        function loadShift(){
            var url_ = 'http://localhost:63342/branch/json/proDis/banci.json';
            ajaxToServer(url_, {}, function(result){
                if(result.success){
                    var rows = result.rows;
                    // resetSelect($('#time'));
                    var options = new Array();
                    $(rows).each(function(i,o){
                        var label = o['name']+'('+o['startTime']+'-'+o['endTime']+')';
                        options.push({'value':o['id'], 'label':label});
                    });
                    appendOptions($('#time'), options);
                }else{
                    layer.msg(result.message);
                }
            });
        }
        //获取班组数据
        function loadGroups(){
            var url_ = 'http://localhost:63342/branch/json/proDis/banzu.json';
            ajaxToServer(url_, {}, function(result){
                if(result.success){
                    var rows = result.rows;
                    appendOptionsValue($('#team'), rows, 'id', 'name');
                }else{
                    layer.msg(result.message);
                }
            });
        }



        //创建table
        function createTable(data) {
            //  datatables使用ajax
            $('#treeTable').dataTable({
                "bPaginate": false,
                "bAutoWidth": false,
                "bDestroy": true,
                "paging": false,
                "bProcessing": true,
                "searching": false, //禁用aa原生搜索
                "info": false,  //底部文字
                "order": [],
                "ordering": false,
                "oLanguage": lang,
                "data": data,
                //定义列 宽度 以及在json中的列名
                "aoColumns": [
                    {"data": "adMonth", 'sClass': " alignCenter authName"},
                    {"data": "adYear", 'sClass': "alignCenter autoWidth"},
                    {"data": "groupName", 'sClass': "alignCenter"},
                    {"data": "itemName", 'sClass': "alignCenter"},
                    {"data": "itemUnit", 'sClass': "alignCenter"},
                    {"data": "siji", 'sClass': "alignCenter"},
                    {"data": "yearout", 'sClass': "alignCenter"}
                ]
            });
            RenderiCheckTblBody();
        }

        //加载数据
        function loadData(){
             var data = {
                 begin:$("#startDateParam").val(),
                 endtime:$("#endDateParam").val(),
                 process:$("#process option:selected").val(),
                 team:$("#team option:selected").val(),
                 time:$("#time option:selected").val(),
                 status:$(".status input:checkbox:checked").next().text(),
                 rank:$("#rank option:selected").val(),
                 classify:$("#classify option:selected").val()
        };

        //指令查看接口地址
        var url_ = 'http://localhost:63342/branch/json/proDis/yeardayplay.json';
        ajaxToServer(url_, JSON.stringify(data), function(result){
            if(result.success){
                var sczb = result.sczb;
                createTable(sczb);
            }else{
                layer.msg(result.message);
            }
        });
    }

//点击查询按钮
$(".btn-search").click(function (e) {
    loadData();
});

</script>
</html>